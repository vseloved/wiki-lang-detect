(in-package #:wiki-lang-detect)
(named-readtables:in-readtable rutilsx-readtable)


;;; heap

(declaim (inline hparent hleft hright heap-size list-bitvec))

(defstruct heap
  (vec (make-array 0 :adjustable t :fill-pointer t))
  op
  (key 'identity))

(defmethod print-object ((obj heap) out)
  (if (zerop (length @obj.vec))
      (format out "#<empty heap>")
      (let ((h (min (+ 1 (floor (log (heap-size obj) 2)))
                    3)))
        (dotimes (i h)
          (let ((spaces (loop :repeat (- (expt 2 (- h i)) 1) :collect #\Space)))
            (dotimes (j (expt 2 i))
              (let ((k (+ (expt 2 i) j -1)))
                (when (= k (heap-size obj)) (return))
                (format out "摸材摸箴徙弩里怅鲥氅箴徙弩┅ㄦ矧磲秕ア┅┅镡戛ㄤ彐躅桊狎孱ㄩㄦ祜矧ō暴博ㄤ彐躅桁彐ㄩōㄨ蜷玷椹暴ㄤ彐躅栩殓梏ㄩíǐ暴博ㄤ彐躅桢狃箝ㄨ遽皓戾铉翳黎遽甬鲥悌ㄤ彐躅桢狃躔ㄨ遽椹祜镳瑚栝戾ㄡ钿痨躞椹ㄣ犰黎遽甬镳ㄣ犰黎遽甬脲黎遽甬鲥椹ㄣ犰黎遽甬脲黎遽甬鲥ㄨ疳蝈铘椹┅┅轰蝻翎翦黎遽甬鲥椹黎遽甬鲥ㄨ疳蝈铘椹┅êㄨ疳蝈铘椹┅桢狃ㄤ彐躅桢狃滹黝ㄨ遽忮镳糸镱犰ㄥ钿ūㄨ遽瓠箝桢狃┅┅麒孱冀ㄨ戾骠忮绌孱洎戾è汨殪ㄩ矧窘ㄨ蜷玷忮绌孱洎ㄣ犰黎遽甬镳ㄣ犰黎遽甬脲黎遽甬鲥ㄨ戾骠忮绌┅ㄣ犰黎遽甬脲黎遽甬鲥ㄨ蜷玷忮绌┅┅ㄨ戾骠忮绌ㄨ蜷玷忮绌┅麒孱ㄣ犰黎遽甬镳ㄣ犰黎遽甬脲黎遽甬鲥汨殪洎ㄣ犰黎遽甬脲黎遽甬鲥忮绌┅蝻翎翦黎遽甬鲥忮绌黎遽甬鲥汨殪洎ㄨ遽瓠滹黝桢狃汨殪孱洎┅桢狃ㄤ彐躅桢狃瘐箬ㄩ翦桢狃ㄨ遽瓠躔桢狃鲥泗矧瘐箬屮翦钿轸屙黎遽甬鲥悌┅ㄤ彐躅桢狃痫ㄨ遽皓蝻翎翦黎遽甬鲥癌黎遽甬鲥ūㄨ遽瓠箝桢狃┅┅痱镧鲥泗矧痫黎遽甬鲥悌ㄨ遽瓠滹黝桢狃癌┅换桴骀磲ㄤ彐鲠桴骀磲瞽溟泗ｈīㄤ彐躅扉篝忾赧邈扉篝镳糸镱犰戾戾铉翳扉篝┅磲脲狎蜥戾哄戾礤铘豉疱р轸洪铋糸犰泔铘孱趔蝈鲥蝮扉篝┅ㄤ彐躅忾瞽趄狯弪箦趄邋溟泗ㄩㄡ麸趄邋ê溟泗趄邋＊癌戾è聃艴扉篝扉篝趄邋ī癌┅祜镳瑚栝戾聃艴轰鏖翳èè祠螋痱祧飑痫聃艴濠祓蝈ㄣ镱痱濠蝠蝈ㄣ镱痱濠祧ū祧飑┅ㄩ扉篝祠瘐箬扉篝祠祓蝈祧飑聃艴濠ê溟泗祠扉篝忾赧邈祓蝈祧飑┅ㄩ扉篝螋瘐箬扉篝螋蝠蝈祧飑聃艴濠ê溟泗螋扉篝忾赧邈蝠蝈祧飑┅┅┅溟泗ㄤ彐躅桴骀磲瞽溟泗é镳糸镱犰盹溴灬铉溴翦泗矧┅戾è泔躅趔ｈㄥ聃犰┅蝈ｈㄥ聃犰┅ㄤ雉徕戾黠蜾理镤屐黠蜾螬祜镳烘矧汨狎横泸矬黠蜾轰戾è沲ㄧ弭箦簦躅殂镤瀛筱蜷痿汨狎泔躅趔ｈī┅êㄧ弭汨狎沲癌┅┅ㄤ雉徕戾ǔ理镤屐崇螬祜镳烘矧汨狎横泸矬崇轰戾è沲ㄧ弭箦簦躅殂镤瀛筱蜷痿汨狎泔躅趔ｈī┅êㄧ弭汨狎沲癌┅┅ㄤ雉徕戾筱蜷痿沲泔躅趔戾è桢狃磲脲桢狃猴Ъ弘妁螋┅ㄤ雉徕戾ㄣ栳泔躅沲颟ㄨ遽瓠瘐箬疳轵汨狎泔躅舂桢狃┅祜镳候屦遽ūㄨ遽瓠箝桢狃┅轰鏖翳è蜷玷泸ㄨ遽瓠痫桢狃┅è戾骠沆ㄨ遽瓠痫桢狃┅ㄨ遽瓠瘐箬疳轵扉篝戾骠蜷玷舂ǐ沆泸┅桢狃┅ê蝈筱蜷痿ㄢ轭趄狯弪箦祠ㄨ遽瓠痫桢狃┅ｈī┅┅蝈┅ㄤ彐躅黠蜾忾赧邈ㄨ蹑骓犷黠蜾扉篝忾赧邈ㄡ痧禊с镱汜翦钺翦鲥泗矧祜镳烘矧汨狎横泸矬黠蜾恒镬戾泗桴骀磲汨狎┅┅ㄤ彐躅桴骀磲瞽孱泔溴黠蜾镳糸镱犰盹溴灬铉溴翦泗矧┅鏖翳è筱蜷痿黠蜾筱蜷痿黠蜾┅ㄨ蹑骓犷理镤屐桴骀磲筱蜷痿┅麒孱桴骀磲蝈漉沐蕤泔钽狒孱狒р轸鲥泗矧ゥ祜镳烘矧汨横泸矬黠蜾恒镬戾泗桴骀磲汨┅┅┅